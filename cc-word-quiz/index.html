<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>è‹±æ–‡å–®å­—æ¸¬é©—</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0e17;--card:#141b2d;--accent:#00d4aa;--danger:#ff4757;
  --warn:#ffa502;--text:#e8e8e8;--dim:#6b7b8d;--blue:#1e90ff;
}
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:var(--bg);color:var(--text);min-height:100dvh;
  display:flex;align-items:center;justify-content:center;padding:12px;
  -webkit-tap-highlight-color:transparent;
}
.screen{display:none;flex-direction:column;align-items:center;width:100%;max-width:420px}
.screen.active{display:flex}
h1{font-size:1.6rem;margin-bottom:6px}
.subtitle{color:var(--dim);font-size:.85rem;margin-bottom:20px}
.rules{
  background:var(--card);border-radius:16px;padding:18px 20px;width:100%;
  margin-bottom:20px;line-height:1.7;font-size:.9rem;color:var(--dim);
}
.rules li{margin-bottom:4px}
.diff-group{display:flex;gap:10px;width:100%;margin-bottom:20px}
.diff-btn{
  flex:1;padding:14px 6px;border-radius:12px;border:2px solid #2a3548;
  background:var(--card);color:var(--text);font-size:.9rem;cursor:pointer;
  transition:border-color .15s,background .15s;text-align:center;
}
.diff-btn.selected{border-color:var(--accent);background:rgba(0,212,170,.1)}
.diff-btn span{display:block;font-size:.75rem;color:var(--dim);margin-top:4px}
.section-label{
  width:100%;font-size:.8rem;color:var(--dim);margin-bottom:6px;
  padding-left:2px;letter-spacing:.5px;
}
.bank-btn{
  flex:1;padding:14px 6px;border-radius:12px;border:2px solid #2a3548;
  background:var(--card);color:var(--text);font-size:.9rem;cursor:pointer;
  transition:border-color .15s,background .15s;text-align:center;
}
.bank-btn.selected{border-color:var(--accent);background:rgba(0,212,170,.1)}
.btn-main:disabled{opacity:.5;cursor:not-allowed}
.btn-main{
  width:100%;padding:16px;border-radius:12px;border:none;
  background:var(--accent);color:#0a0e17;font-size:1.05rem;font-weight:700;
  cursor:pointer;transition:transform .1s,opacity .1s;
}
.btn-main:active{transform:scale(.95);opacity:.85}

/* game screen */
.top-bar{
  display:flex;justify-content:space-between;align-items:center;
  width:100%;margin-bottom:16px;font-size:.85rem;color:var(--dim);
}
.level-badge{
  background:var(--card);border-radius:20px;padding:4px 12px;font-size:.78rem;
}
.timer-wrap{position:relative;width:100px;height:100px;margin:0 auto 18px}
.timer-wrap svg{transform:rotate(-90deg)}
.timer-ring{
  fill:none;stroke:var(--accent);stroke-width:5;stroke-linecap:round;
  transition:stroke .3s;
}
.timer-bg{fill:none;stroke:#1a2236;stroke-width:5}
.timer-num{
  position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  font-size:1.8rem;font-weight:700;
}
.q-card{
  background:var(--card);border-radius:16px;padding:22px 20px;width:100%;
  margin-bottom:16px;text-align:center;
}
.q-tag{
  display:inline-block;background:rgba(0,212,170,.12);color:var(--accent);
  border-radius:20px;padding:3px 12px;font-size:.72rem;margin-bottom:10px;
}
.q-word{font-size:1.5rem;font-weight:700;letter-spacing:.5px}
.q-phonetic{color:var(--dim);font-size:.85rem;margin-top:6px}
.opts{display:flex;flex-direction:column;gap:10px;width:100%;margin-bottom:14px}
.opt-btn{
  width:100%;padding:15px 18px;border-radius:12px;border:2px solid #2a3548;
  background:var(--card);color:var(--text);font-size:.95rem;cursor:pointer;
  text-align:left;transition:border-color .15s,background .15s;
}
.opt-btn:active{transform:scale(.97)}
.opt-btn.correct{border-color:var(--accent);background:rgba(0,212,170,.12)}
.opt-btn.wrong{border-color:var(--danger);background:rgba(255,71,87,.12)}
.opt-btn.reveal{border-color:var(--accent);opacity:.6}
.opt-btn.disabled{pointer-events:none}
.explain{
  width:100%;background:rgba(30,144,255,.08);border-left:3px solid var(--blue);
  border-radius:0 10px 10px 0;padding:12px 14px;font-size:.85rem;
  line-height:1.5;display:none;
}
.explain .verdict{font-weight:700;margin-bottom:4px}

/* result screen */
.result-emoji{font-size:3rem;margin-bottom:8px}
.result-score{font-size:3.2rem;font-weight:800;color:var(--accent)}
.result-score span{font-size:1rem;color:var(--dim);font-weight:400}
.rank-badge{
  display:inline-block;background:var(--card);border-radius:20px;
  padding:6px 18px;font-size:.9rem;margin:10px 0 8px;
}
.rank-msg{color:var(--dim);font-size:.85rem;text-align:center;margin-bottom:18px;line-height:1.6}
.stats{
  display:flex;gap:16px;justify-content:center;margin-bottom:24px;font-size:.85rem;
}
.stats div{text-align:center}
.stats .num{font-size:1.4rem;font-weight:700}

@keyframes shake{
  0%,100%{transform:translateX(0)}
  20%,60%{transform:translateX(-4px)}
  40%,80%{transform:translateX(4px)}
}
.shake{animation:shake .35s}
@keyframes pulse{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.08)}
}
.pulse{animation:pulse .4s}
</style>
</head>
<body>

<!-- START SCREEN -->
<div id="startScreen" class="screen active">
  <h1>ğŸ“ è‹±æ–‡å–®å­—æ¸¬é©—</h1>
  <p class="subtitle">æ¸¬æ¸¬ä½ çš„è‹±æ–‡å–®å­—é‡ï¼</p>
  <ul class="rules">
    <li>ğŸ“Œ å…± 10 é¡Œï¼Œæ¯é¡Œ 4 å€‹ä¸­æ–‡é¸é …</li>
    <li>â±ï¸ é™æ™‚ä½œç­”ï¼Œè¶…æ™‚ç®—éŒ¯</li>
    <li>âœ… æ¯é¡Œç­”å®Œç«‹å³é¡¯ç¤ºå°éŒ¯èˆ‡è§£é‡‹</li>
    <li>ğŸ† æœ€å¾Œçµ±è¨ˆå¾—åˆ†èˆ‡ç­‰ç´š</li>
  </ul>
  <div class="section-label">é¡Œåº«</div>
  <div class="diff-group">
    <button class="bank-btn selected" data-bank="3000" onclick="selectBank(this)">ğŸ“— å¸¸ç”¨ 3000 å–®</button>
    <button class="bank-btn" data-bank="7000" onclick="selectBank(this)">ğŸ“˜ å¸¸ç”¨ 7000 å–®</button>
  </div>
  <div class="section-label">é›£åº¦</div>
  <div class="diff-group">
    <button class="diff-btn" data-time="20" onclick="selectDiff(this)">ğŸŸ¢ å…¥é–€<span>20 ç§’</span></button>
    <button class="diff-btn selected" data-time="10" onclick="selectDiff(this)">ğŸŸ¡ å°ˆå®¶<span>10 ç§’</span></button>
    <button class="diff-btn" data-time="5" onclick="selectDiff(this)">ğŸ”´ å¿«æ‰‹<span>5 ç§’</span></button>
  </div>
  <button class="btn-main" id="btnStart" onclick="startGame()">é–‹å§‹æ¸¬é©—</button>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen" class="screen">
  <div class="top-bar">
    <div id="progress">1 / 10</div>
    <div id="levelBadge" class="level-badge">ğŸŸ¡ å°ˆå®¶ Â· 10s</div>
    <div id="scoreDisplay">0 åˆ†</div>
  </div>
  <div class="timer-wrap">
    <svg width="100" height="100" viewBox="0 0 100 100">
      <circle class="timer-bg" cx="50" cy="50" r="44"/>
      <circle id="timerRing" class="timer-ring" cx="50" cy="50" r="44"
        stroke-dasharray="276.46" stroke-dashoffset="0"/>
    </svg>
    <div id="timerNum" class="timer-num">10</div>
  </div>
  <div class="q-card">
    <div class="q-tag" id="qTag">åè©</div>
    <div class="q-word" id="qWord">example</div>
    <div class="q-phonetic" id="qPhonetic"></div>
  </div>
  <div class="opts" id="opts"></div>
  <div class="explain" id="explain"></div>
</div>

<!-- RESULT SCREEN -->
<div id="resultScreen" class="screen">
  <div class="result-emoji" id="resultEmoji">ğŸ†</div>
  <div class="result-score"><span>å¾—åˆ†</span><br><span id="finalScore">100</span><span> / 100</span></div>
  <div class="rank-badge" id="rankBadge">ğŸ“š å–®å­—é”äºº</div>
  <p class="rank-msg" id="rankMsg">å¤ªå²å®³äº†ï¼</p>
  <div class="stats">
    <div><div class="num" id="statCorrect" style="color:var(--accent)">0</div>ç­”å°</div>
    <div><div class="num" id="statWrong" style="color:var(--danger)">0</div>ç­”éŒ¯</div>
    <div><div class="num" id="statTimeout" style="color:var(--warn)">0</div>è¶…æ™‚</div>
  </div>
  <button class="btn-main" onclick="restart()">å†ç©ä¸€æ¬¡</button>
</div>

<script>
/* â”€â”€ éŠæˆ²ç‹€æ…‹ â”€â”€ */
let BANK=[];
let bankChoice='3000';
let questions=[], current=0, score=0, timeLimit=10;
let correctCount=0, wrongCount=0, timeoutCount=0, answered=false;
let timerInterval=null, startTime=0;
const TOTAL=10, CIRC=2*Math.PI*44;
const bankCache={};

/* â”€â”€ å·¥å…· â”€â”€ */
const $=id=>document.getElementById(id);
const show=id=>{
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  $(id).classList.add('active');
};
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.random()*(i+1)|0;[a[i],a[j]]=[a[j],a[i]]}return a}

/* â”€â”€ é¡Œåº«é¸æ“‡ â”€â”€ */
function selectBank(btn){
  document.querySelectorAll('.bank-btn').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  bankChoice=btn.dataset.bank;
  loadBank(bankChoice);
}

/* â”€â”€ è¼‰å…¥é¡Œåº« JSON â”€â”€ */
function loadBank(key){
  if(bankCache[key]){
    BANK=bankCache[key];
    $('btnStart').disabled=false;
    return;
  }
  $('btnStart').disabled=true;
  $('btnStart').textContent='è¼‰å…¥é¡Œåº«ä¸­â€¦';
  fetch('data/words_'+key+'.json')
    .then(r=>{
      if(!r.ok) throw new Error('HTTP '+r.status);
      return r.json();
    })
    .then(data=>{
      bankCache[key]=data;
      BANK=data;
      $('btnStart').disabled=false;
      $('btnStart').textContent='é–‹å§‹æ¸¬é©—';
    })
    .catch(e=>{
      console.error('è¼‰å…¥é¡Œåº«å¤±æ•—:',e);
      $('btnStart').textContent='è¼‰å…¥å¤±æ•—ï¼Œè«‹é‡è©¦';
      setTimeout(()=>{
        $('btnStart').disabled=false;
        $('btnStart').textContent='é–‹å§‹æ¸¬é©—';
      },2000);
    });
}

/* â”€â”€ é›£åº¦é¸æ“‡ â”€â”€ */
function selectDiff(btn){
  document.querySelectorAll('.diff-btn').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  timeLimit=+btn.dataset.time;
}

/* â”€â”€ é–‹å§‹éŠæˆ² â”€â”€ */
function startGame(){
  if(!BANK.length){loadBank(bankChoice);return;}
  const picked=shuffle([...BANK]).slice(0,TOTAL);
  questions=picked;
  current=0; score=0; correctCount=0; wrongCount=0; timeoutCount=0;
  const labels={20:'ğŸŸ¢ å…¥é–€',10:'ğŸŸ¡ å°ˆå®¶',5:'ğŸ”´ å¿«æ‰‹'};
  const bankLabels={'3000':'ğŸ“— 3000','7000':'ğŸ“˜ 7000'};
  $('levelBadge').textContent=(bankLabels[bankChoice]||'ğŸ“— 3000')+' Â· '+(labels[timeLimit]||'ğŸŸ¡ å°ˆå®¶')+' Â· '+timeLimit+'s';
  $('scoreDisplay').textContent='0 åˆ†';
  show('gameScreen');
  loadQuestion();
}

/* â”€â”€ é é¢è¼‰å…¥æ™‚é è¼‰é è¨­é¡Œåº« â”€â”€ */
loadBank(bankChoice);

/* â”€â”€ è¼‰å…¥é¡Œç›® â”€â”€ */
function loadQuestion(){
  answered=false;
  const q=questions[current];
  $('progress').textContent=(current+1)+' / '+TOTAL;
  $('qTag').textContent=q.pos;
  $('qWord').textContent=q.word;
  $('qPhonetic').textContent=q.phonetic;
  $('explain').style.display='none';

  const opts=shuffle([...q.opts]);
  const container=$('opts');
  container.innerHTML='';
  opts.forEach((o,i)=>{
    const btn=document.createElement('button');
    btn.className='opt-btn';
    btn.textContent=o;
    btn.onclick=()=>answer(btn,o,q);
    container.appendChild(btn);
  });

  // timer
  clearInterval(timerInterval);
  startTime=Date.now();
  $('timerRing').style.stroke='var(--accent)';
  updateTimer();
  timerInterval=setInterval(updateTimer,50);
}

function updateTimer(){
  const elapsed=(Date.now()-startTime)/1000;
  const remain=Math.max(timeLimit-elapsed,0);
  $('timerNum').textContent=Math.ceil(remain);

  const pct=remain/timeLimit;
  $('timerRing').setAttribute('stroke-dashoffset',CIRC*(1-pct));

  // é¡è‰²
  const dangerAt=timeLimit<=5?1:timeLimit<=10?3:5;
  const warnAt=timeLimit<=5?2:timeLimit<=10?5:10;
  if(remain<=dangerAt) $('timerRing').style.stroke='var(--danger)';
  else if(remain<=warnAt) $('timerRing').style.stroke='var(--warn)';

  if(remain<=0&&!answered) onTimeout();
}

/* â”€â”€ ä½œç­” â”€â”€ */
function answer(btn,choice,q){
  if(answered)return;
  answered=true;
  clearInterval(timerInterval);

  const isCorrect=choice===q.answer;
  const allBtns=document.querySelectorAll('.opt-btn');
  allBtns.forEach(b=>{
    b.classList.add('disabled');
    if(b.textContent===q.answer) b.classList.add(isCorrect?'correct':'reveal');
  });
  if(isCorrect){
    btn.classList.add('correct');
    score+=10;
    correctCount++;
    $('scoreDisplay').textContent=score+' åˆ†';
    document.querySelector('.q-card').classList.add('pulse');
  } else {
    btn.classList.add('wrong');
    wrongCount++;
    document.querySelector('.q-card').classList.add('shake');
  }

  showExplain(isCorrect?'correct':'wrong',q);
  setTimeout(()=>{
    document.querySelector('.q-card').classList.remove('pulse','shake');
    nextOrResult();
  },1800);
}

function onTimeout(){
  if(answered)return;
  answered=true;
  clearInterval(timerInterval);
  timeoutCount++;

  const q=questions[current];
  const allBtns=document.querySelectorAll('.opt-btn');
  allBtns.forEach(b=>{
    b.classList.add('disabled');
    if(b.textContent===q.answer) b.classList.add('reveal');
  });
  document.querySelector('.q-card').classList.add('shake');
  showExplain('timeout',q);
  setTimeout(()=>{
    document.querySelector('.q-card').classList.remove('shake');
    nextOrResult();
  },1800);
}

function showExplain(type,q){
  const el=$('explain');
  const labels={correct:'âœ… ç­”å°äº†ï¼',wrong:'âŒ ç­”éŒ¯äº†',timeout:'â±ï¸ æ™‚é–“åˆ°ï¼'};
  const colors={correct:'var(--accent)',wrong:'var(--danger)',timeout:'var(--warn)'};
  el.innerHTML='<div class="verdict" style="color:'+colors[type]+'">'+labels[type]+'</div>'
    +'<div><strong>'+q.word+'</strong> â†’ '+q.answer+'</div>'
    +'<div style="margin-top:4px;color:var(--dim)">'+q.tip+'</div>';
  el.style.display='block';
}

function nextOrResult(){
  current++;
  if(current<TOTAL) loadQuestion();
  else showResult();
}

/* â”€â”€ çµæœ â”€â”€ */
function showResult(){
  clearInterval(timerInterval);
  let emoji,rank,msg;
  if(score>=90){
    emoji='ğŸ†';rank='ğŸ“š å–®å­—é”äºº';
    msg='ä½ çš„è‹±æ–‡å–®å­—é‡éå¸¸è±å¯Œï¼Œç¹¼çºŒä¿æŒï¼';
  } else if(score>=70){
    emoji='ğŸŒŸ';rank='ğŸ“– é€²éšå­¸ç¿’è€…';
    msg='åŸºç¤ç´®å¯¦ï¼Œå†å¤šèƒŒä¸€äº›é€²éšå–®å­—å°±æ›´å²å®³äº†ï¼';
  } else if(score>=50){
    emoji='ğŸ’ª';rank='âœï¸ ç©©æ­¥å‰é€²';
    msg='æœ‰ä¸€å®šåŸºç¤ï¼ŒæŒçºŒå­¸ç¿’ä¸€å®šèƒ½çªç ´ï¼';
  } else {
    emoji='ğŸ“–';rank='ğŸŒ± åˆå­¸è€…';
    msg='æ¯å¤©è¨˜å¹¾å€‹å–®å­—ï¼Œç©å°‘æˆå¤šï¼ŒåŠ æ²¹ï¼';
  }
  $('resultEmoji').textContent=emoji;
  $('finalScore').textContent=score;
  $('rankBadge').textContent=rank;
  $('rankMsg').textContent=msg;
  $('statCorrect').textContent=correctCount;
  $('statWrong').textContent=wrongCount;
  $('statTimeout').textContent=timeoutCount;
  show('resultScreen');
}

function restart(){show('startScreen')}
</script>
</body>
</html>
